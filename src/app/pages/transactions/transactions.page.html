<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="cancel()">Volver</ion-button>
    </ion-buttons>
    <ion-title>Nueva Transacción</ion-title>
    <ion-buttons slot="end">
      <!-- <ion-button (click)="submit()" [disabled]="form.invalid">Guardar</ion-button> -->
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="tx-content">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Nueva Transacción</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="section">
    <ion-segment [value]="form.get('type')?.value" (ionChange)="onTypeSegmentChange($event)">
      <ion-segment-button value="income">Ingreso</ion-segment-button>
      <ion-segment-button value="expense">Gasto</ion-segment-button>
    </ion-segment>
  </div>
  
  <ion-item class="section">
    <ion-input label="Ingresa el monto" labelPlacement="floating" [formControl]="form.controls.amount" inputmode="numeric" (ionInput)="formatAmount($event)" type="text" clearInput></ion-input>
  </ion-item>

  <div *ngIf="form.get('type')?.value === 'expense'" class="section">
    <ion-item button detail (click)="openCategoryModal()">
      <div slot="start" class="icon-wrap">
        <span class="material-icons">{{ getCategoryIcon(form.get('category')?.value) }}</span>
      </div>
      <ion-label>Categoría: {{ getCategoryLabel(form.get('category')?.value) }}</ion-label>
    </ion-item>
  </div>
  
  <ion-item class="section">
    <ion-label position="stacked">Fecha</ion-label>
    <ion-datetime-button datetime="datetime"></ion-datetime-button>
  </ion-item>

  <ion-item class="section">
    <ion-label position="stacked">Nota</ion-label>
    <ion-input [formControl]="form.controls.note"></ion-input>
  </ion-item>

  <div class="primary-action">
    <ion-button expand="block" size="large" (click)="submit()" [disabled]="form.invalid">Agregar</ion-button>
  </div>
</ion-content>


  <ion-modal [isOpen]="categoryOpen" (didDismiss)="setOpen(false)">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Categoría Gasto</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="setOpen(false)">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
        <ion-content class="ion-padding">
      <div class="category-section">
        <div class="category-grid">
          <div class="category-card" *ngFor="let c of categories" [class.selected]="form.get('category')?.value === c.value"
            (click)="selectCategory(c.value)" role="button" tabindex="0" >
            <div class="icon-wrap">
              <span class="material-icons">{{ c.icon }}</span>
            </div>
            <div class="text-wrap">
              <div class="title">{{ c.label }}</div>
            </div>
          </div>
        </div>
      </div>
    </ion-content>
    </ng-template>
  </ion-modal>


  <ion-modal [keepContentsMounted]="true">
  <ng-template>
    <ion-datetime id="datetime" presentation="date" [formControl]="form.controls.date" ></ion-datetime>
  </ng-template>
</ion-modal>
